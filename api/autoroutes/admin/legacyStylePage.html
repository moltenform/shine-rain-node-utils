

{% extends "index.njk.html" %} 


{% block content %}

<br/><br/><br/>
Value passed from server is "{{ abc }}".
<br/><br/><br/>

<button id="btnBegin">Begin the test</button>
<button id="btnIncr">Increment counter</button>
<button id="btnIncrJson">Increment counter in json</button>
<button id="btnTestRollback">Test rollback (should cause no changes)</button>
<script>
    import * as pageLogic from '/assets/client-shared/pagelogic.js';
 
    const btnIds = ["btnBegin", "btnIncr", "btnIncrJson"]
    for (let id of btnIds) {
        pageLogic.byId('btn').addEventListener('click', async ()=>{
            await pageLogic.callApiOrThrow(document.location.toString(), 'post',  {action: id})
            document.reload()
        })    
    }

    pageLogic.byId('btnTestRollback').addEventListener('click', async ()=>{
        var gotE
        try {
            await pageLogic.callApiOrThrow(document.location.toString(), 'post',  {action: 'btnTestRollback'})
        } catch (e) {
            gotE = e
        }
        if (gotE) {
            pageLogic.alert("Test failed-expected to see an error.")
        }
        
        document.reload()
    })
</script>


{% endblock %}

